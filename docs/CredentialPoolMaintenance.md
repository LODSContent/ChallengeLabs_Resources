# Maintaining Credential Pools for Skillable Challenge Labs

## Introduction

This documentation provides guidance on maintaining the credential pools used in Skillable Challenge Labs for Azure environments, specifically those involving Microsoft Entra ID and trial subscriptions like Entra ID P2 or Power BI (PBI). It is based on a video demonstration of the maintenance process for three key pools: Entra ID P2 Challenges v3, PBI Challenges Tenant Pool, and Challenge Labs Tenant Pool #1.

The pools are part of the "Cloud Credential Pool" feature in the lab platform, which stores Azure tenant details (e.g., tenants, credentials) for student use or automation. For more details on Cloud Credential Pools, refer to the official documentation: [Skillable Cloud Credential Pool Docs](https://docs.skillable.com/docs/cloud-credential-pool).

Regular maintenance ensures expired credentials are migrated between pools, preventing shortages and allowing reuse where appropriate. This process involves exporting, cleaning, importing, and deleting credentials. While some steps can be automated with tools like Tampermonkey scripts, this documentation focuses on the manual workflow. Perform maintenance every 3-4 weeks or when available credentials drop significantly.

## Overview

The three pools support labs requiring Entra ID access or trials, following a lifecycle where credentials "age" and move downstream:

- **Entra ID P2 Challenges v3 Pool**: Used for labs needing a 30-day Entra ID P2 trial. Credentials are manually generated by a contractor, including a new tenant, trial request, scripting app ID, and secret. The trial expiration is set (typically 29-30 days). Once expired, credentials are unavailable for allocation but remain in the pool until migrated.

- **PBI Challenges Tenant Pool**: Composed of expired credentials from the Entra ID P2 pool. Used for labs needing a 60-day PBI trial, which students request themselves (starting the 60-day timer). The pool is configured for reuse up to 59 days after assignment. After 59 days, credentials expire and become unavailable.

- **Challenge Labs Tenant Pool #1**: Receives expired credentials from the PBI pool. Used for non-trial Entra ID labs (e.g., user/group creation, permission assignments). Credentials are assigned to users "forever" and cannot be reused by others until manually unassigned. No expiration is set, but periodic unassignment of old allocations is needed to free them up.

**Credential Flow**:
1. New tenants with Entra ID P2 trials start in the Entra ID P2 pool.
2. Expired Entra ID P2 credentials move to the PBI pool for PBI trials.
3. Expired PBI credentials move to the Challenge Labs pool for indefinite reuse.

This structure recycles tenants efficiently, as Entra ID activities incur no significant costs. Maintenance prevents pool bloat and ensures availability.

## Step-by-Step Instructions

Maintenance involves two main migrations: from Entra ID P2 to PBI, and from PBI to Challenge Labs #1. Use the lab platform's interface for searches, exports, and imports. Tools like Excel (for CSV cleanup) and a text editor (e.g., Notepad++) are recommended. For bulk unassign/delete operations, a Tampermonkey script can automate clicks (setup not covered here; perform manually if needed).

### Section 1: Migrating Expired Credentials from Entra ID P2 Challenges v3 to PBI Challenges Tenant Pool

1. **Access the Entra ID P2 Pool**:
   - Log in to the lab platform and navigate to the Entra ID P2 Challenges v3 pool.
   - Note the total credentials and available ones (e.g., aim to keep ~90 available via contractor additions).

2. **Search for Expired Credentials**:
   - Set the view to 100 items per page for easier navigation.
   - Add a filter: "Expires Before" [current date at 12:00 AM] (e.g., 1/20/2026 at 12:00 AM to capture anything expired on or before 1/19/2026).
   - This identifies credentials past their 30-day trial. Avoid including credentials expiring today or later to prevent disrupting active users.

3. **Export the Expired Credentials**:
   - With the filtered list, click "Export" to download a CSV file.
   - Save with a descriptive name (e.g., "EntraIDP2_Expired_1-19-2026_to_PBI.csv").

4. **Clean the CSV File**:
   - Open the CSV in Excel.
   - Retain only required columns: Username, Password, Tenant Name, Scripting App ID, Scripting App Secret.
   - Delete unnecessary columns (e.g., Trial Expiration, Expires, Assigned To, etc.).
   - Save as a new file (e.g., "EntraIDP2_Expired_Cleaned.csv").
   - Open the cleaned file in a text editor (e.g., Notepad++).
   - Delete the header row (first line with column names).
   - Ensure data is comma-separated and in the correct order (no extra commas or artifacts; use find/replace if needed, e.g., remove trailing ",," ).

5. **Import into the PBI Pool**:
   - Navigate to the PBI Challenges Tenant Pool.
   - Click "Add Credentials".
   - Do not set an expiration (PBI trials start on student request).
   - Copy the cleaned CSV data (excluding header) and paste into the import field (format: one credential per line, fields comma-separated).
   - Click "OK" to import.
   - Refresh the page to verify the increase in total/available credentials.

6. **Delete from the Entra ID P2 Pool**:
   - Return to the Entra ID P2 pool with the same "Expires Before" filter.
   - For each credential: Click "Unassign" > OK, then "Delete" > OK.
   - For large numbers (e.g., 150+), use a Tampermonkey script to automate (input the number to process in batches). Ensure the filter remains active to avoid deleting active credentials.
   - Refresh and confirm expired credentials are gone; total should decrease accordingly.

### Section 2: Migrating Expired Credentials from PBI Challenges Tenant Pool to Challenge Labs Tenant Pool #1

1. **Access the PBI Pool**:
   - Navigate to the PBI Challenges Tenant Pool.
   - Note: Expirations here are based on assignment date + 59 days (reuse setting), not a fixed field.

2. **Search for Expired Credentials**:
   - Set to 100 items per page.
   - Add a filter: "Assigned More Than" 59 days ago.
   - This lists credentials past their reuse period. Note the last credential in the list (e.g., screenshot the details like assignment date/user for reference).

3. **Export the Expired Credentials**:
   - With the filtered list, click "Export" to download a CSV.
   - Save with a descriptive name (e.g., "PBI_Expired_59Days_to_Challenge1.csv").

4. **Clean the CSV File**:
   - Open in Excel.
   - Retain only: Username, Password, Tenant Name, Scripting App ID, Scripting App Secret.
   - Delete other columns (e.g., Expires, Assigned To, Last Name, etc.).
   - Save as a new file.
   - Open in a text editor, delete the header row, and clean any artifacts (e.g., trailing commas via find/replace).

5. **Import into the Challenge Labs Pool**:
   - Navigate to Challenge Labs Tenant Pool #1.
   - Click "Add Credentials".
   - No expiration needed (these last indefinitely).
   - Paste the cleaned CSV data.
   - Click "OK" to import.
   - Refresh to verify the increase (e.g., available credentials rise).

6. **Delete from the PBI Pool**:
   - Return to the PBI pool.
   - Remove the filter temporarily for deletion (unassigned items drop out of filtered views).
   - Set to 100 per page and navigate to the relevant pages based on your earlier screenshot/reference.
   - For each: "Unassign" > OK, then immediately "Delete" > OK (act quickly to avoid re-assignment).
   - Process up to the last identified credential; do not exceed.
   - For large numbers, use Tampermonkey in batches (e.g., 100, then 100, then manual for the rest).
   - Confirm by re-applying the filter; expired credentials should be gone.

## Additional Tips
- **Frequency**: Perform every 3-4 weeks or when available credentials are low.
- **Risks**: Avoid duplicating credentials across pools (causes conflicts). Always use filters carefully during deletion.
- **Automation**: Tampermonkey scripts speed up unassign/delete; limit batches to avoid errors.
- **Monitoring**: Track pool stats (total vs. available) to anticipate maintenance.
- **Challenge Labs Cleanup**: Periodically unassign old allocations in Challenge Labs #1 (search "Assigned Before" a past date) to free credentials, even if not migrating.

This process ensures smooth lab operations. If issues arise, consult the Skillable docs or team for support.
